{% extends 'app/base.html' %}
{% load static %}
{% block title %}Your Orders{% endblock title %}
{% block main-content %}

{% if messages %}
<div style="width: 30%;" class="container">
  {% for message in messages %}
  <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert" style="position: relative;">
    {{ message }}
    <button type="button" class="close" data-dismiss="alert" aria-label="Close"
      style="position: absolute; top: 50%; transform: translateY(-50%); right: 0; height: 30px; width: 30px; border: none; background-color: transparent;"
      onclick="this.parentElement.style.display='none';">
      <span aria-hidden="true" style="font-size: 20px; color: #000;">&times;</span>
    </button>
  </div>
  {% endfor %}
</div>
{% endif %}

<div class="container my-5">
  <div class="row">
    <h3>Welcome <span class="text-capitalize">{{request.user}}</span></h3>
    <div class="col-sm-2 border-end">
      <ul class="list-unstyled">
        <li class="d-grid"><a href="{% url 'orders' %}" class="btn btn-primary">Orders</a></li>
      </ul>
    </div>
    <div class="col-sm-9 offset-sm-1">
      {% for op in order_placed %}
      <div class="row shadow-sm mb-3">
        <div class="col-sm-2" style="padding:10px;">
          <img src="{{op.product.product_image.url}}" alt="" srcset="" class="img-fluid" width="150" height="150">
        </div>
        <div class="col-sm-7">
          <p><b>Product: {{op.product.title}}</b></p>
          <p>Quantity: {{op.quantity}}</p>
          <p>Price: {{op.total_cost}}</p>
        </div>
        <div class="col-sm-3 fw-bold">
          <p>Order Status: {{op.status}}</p>
          {% if op.status == 'Accepted' %}
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width:20%" aria-valuenow="20" aria-valuemin="0"
              aria-valuemax="100"></div>
          </div>
          {% endif %}

          {% if op.status == 'Packed' %}
          <div class="progress">
            <div class="progress-bar bg-info" role="progressbar" style="width:40%" aria-valuenow="20" aria-valuemin="0"
              aria-valuemax="100"></div>
          </div>
          {% endif %}

          {% if op.status == 'On The Way' %}
          <div class="progress">
            <div class="progress-bar bg-warning" role="progressbar" style="width:70%" aria-valuenow="20"
              aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          {% endif %}

          {% if op.status == 'Delivered' %}
          <div class="progress">
            <div class="progress-bar bg-success" role="progressbar" style="width:100%" aria-valuenow="20"
              aria-valuemin="0" aria-valuemax="100"></div>
          </div>

          {% comment %} <button type="button" id="returnButton" class="btn btn-warning mt-2" data-bs-toggle="modal"
            data-bs-target="#returnnModal">
            Return {{ op.product.id }}
          </button> {% endcomment %}

          <!-- Return Modal -->
          {% comment %} <div class="modal fade" id="returnnModal" tabindex="-1" aria-labelledby="#returnModalLabel" aria-hidden="true"> {% endcomment %}
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                   <h5 class="modal-title" id="returnModalLabel">Return Product {{ op.product.id }}</h5> {% comment %} {{ op.product.id }} giving different value {% endcomment %}
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <form action="/returnpro/" method="post" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="prod_id" value="{{ op.product.id }}" id="prod_id_combined"> {% comment %}and her {{ op.product.id }} giving different value {% endcomment %}
                    <label for="reason">Reason:</label>
                    <input type="text" id="reason" name="reason" class="form-control" required>
                    <button type="submit" class="btn btn-primary mt-3">Submit</button>
                  </form>
                </div>
              </div>
            </div>
          {% comment %} </div> {% endcomment %}
          {% endif %}
        </div>
      </div>
      

      {% endfor %}

    </div>
  </div>
</div>

{% if op.status != 'Delivered' %}

<div style="color:red;" class="text-center my-5">
  If Your order will not delivered within 7 days. Please contact us at <strong>+91 1234567899</strong>.
</div>

{% endif %}

{% endblock main-content %}
{% debug %}