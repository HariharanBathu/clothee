{% extends 'app/base.html' %}
{% load static %}
{% block title %}Profile{% endblock title %}
{% block main-content %}
<div class="container my-5">
 <div class="row">
  <h3>Welcome <span class="text-capitalize">{{request.user}}</span></h3>
  <div class="col-sm-2 border-end">
   <ul class="list-unstyled">
    <li class="d-grid"><a href="{% url 'profile' %}" class="btn {{active}}">Profile</a></li>
    <li class="d-grid"><a href="{% url 'address' %}" class="btn">Saved Address</a></li>
   </ul>
  </div>
  <div class="col-sm-8 offset-sm-1">
    <div id="error-message" class="text-danger"></div>

   <form action="" method="post" novalidate>
    {% csrf_token %}
    {% for fm in form %}
      <div class="form-group col-lg-6 mb-3">
        {{fm.label_tag}} {{fm}} <small class="text-danger">{{fm.errors|striptags}}</small>
      </div>
    {% endfor %}
    
    <div class="col-12 mt-3">
      <button type="submit" class="btn btn-primary">Submit</button>
    </div>
   </form>
   {% if messages %}
     {% for message in messages %}
      <p {% if message.tags %} class="alert alert-{{message.tags}} mb-5" {% endif %}>{{message}}</p>
     {% endfor %}
   {% endif %}
  </div>
 </div>
</div>


<!-- Include jQuery library (if not already included) -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
  $(document).ready(function() {
    // Intercept the form submission
    $('form').submit(function(e) {
      e.preventDefault(); // Prevent the default form submission
      
      // Perform client-side validation
      if (!$(this)[0].checkValidity()) {
        // If the form is not valid, display an error message
        $('#error-message').text('First fill the form');
        return false;
      }
      
      // Clear any previous error messages
      $('#error-message').text('');
      
      // Submit the form using AJAX
      $.ajax({
        url: $(this).attr('action'), // Get the form action URL
        type: $(this).attr('method'), // Get the form method (POST in this case)
        data: $(this).serialize(), // Serialize form data
        success: function(data) {
          // Handle the success response (if needed)
          
          // Redirect to the desired URL
          window.location.href = '{% url 'checkout' %}'; // Replace with your desired URL
        },
        error: function(xhr, status, error) {
          // Handle the error response (if needed)
        }
      });
    });
  });
</script>


{% endblock main-content %}